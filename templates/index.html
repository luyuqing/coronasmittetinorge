<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Number of Confirmed Coronavirus Cases in Norway</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 85%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <h4>&nbsp;&nbsp;Confirmed ie. tested positive coronavirus infected cases in Norway, zoom in/out or scroll below map for more info.</h4>
    <h4>&nbsp;&nbsp;Total: <span id='total_number' style="color: red;"></span>, new cases: <span id='new_cases_number' style="color: red;"></span>, cured/recovered <span style="color: green;">0</span>, updated at: <span style="color: blue;">2020-Mar-05 20:00:00</span></h4>
    <p id="yesterday_number" style="display: none;">63</p>
    <div id="map"></div>
    <div>
    <h4>&nbsp;&nbsp;PLEASE NOTE: This website utilizes public info from FHI, NRK, VG etc. therefore location for individual case can only be traced to kommune level. The location of red marker <img style="width:15px;height:18px;" src=https://recoveryannearundel.org/wp-content/uploads/2016/09/google-maps-marker-for-residencelamontagne-hi.png > CANNOT represent the accurate location of case.</h4>
    <h4>&nbsp;&nbsp;Numbers based on area:</h4>
    <ul id='area_number'></ul>
    <h4>&nbsp;&nbsp;VG live update & FHI nyheter:</h4>
    <ul>
    <li><a href="https://www.vg.no/spesial/2020/corona-viruset/?utm_source=vgfront&utm_content=row-7">https://www.vg.no/spesial/2020/corona-viruset/?utm_source=vgfront&utm_content=row-7</a></li>
    <li><a href="https://www.fhi.no/nyheter/">https://www.fhi.no/nyheter/</a></li>
    </ul>
    <h4>&nbsp;&nbsp;Sources for this website's data:</h4>
    <ul>
    <!-- <li><a href=""></a></li> -->
    <li><a href="https://www.vg.no/nyheter/innenriks/i/kJO6PQ/fhi-56-personer-er-smittet-i-norge">fhi-56-personer-er-smittet-i-norge</a></li>
    <li><a href="https://www.vg.no/nyheter/innenriks/i/dO2l2z/fhi-fraraader-reiser-til-nord-italia">fhi-fraraader-reiser-til-nord-italia</a></li>
    <li><a href="https://www.fhi.no/nyheter/2020/oppdaterte-tall-pa-antall-smittede-med-koronavirus-i-norge4/">oppdaterte-tall-pa-antall-smittede-med-koronavirus-i-norge4</a></li>
    <li><a href="https://www.vg.no/nyheter/innenriks/i/zG1Gab/helsedirektoratet-32-er-smittet-av-coronaviruset-i-norge">helsedirektoratet-32-er-smittet-av-coronaviruset-i-norge</a></li>
    <li><a href="https://www.vg.no/nyheter/innenriks/i/9vdv4w/to-bekreftet-smittet-i-drammen">to-bekreftet-smittet-i-drammen</a></li>
    <li><a href="https://www.vg.no/nyheter/innenriks/i/RRpR8A/ytterligere-en-ansatt-smittet-paa-ullevaal">ytterligere-en-ansatt-smittet-paa-ullevaal</a></li>
    <li><a href="https://www.nrk.no/vestland/alt-du-treng-a-vite-om-koronaviruset-i-vestland-1.14925249">alt-du-treng-a-vite-om-koronaviruset-i-vestland</a></li>
    <li><a href="https://fhi.no/nyheter/2020/oppdaterte-tall-pa-antall-smittede-med-koronavirus-i-norge3/">oppdaterte-tall-pa-antall-smittede-med-koronavirus-i-norge3</a></li>
    <li><a href="https://www.vg.no/nyheter/innenriks/i/dO83lB/helsedirektoratet-det-kan-bli-mer-omfattende">helsedirektoratet-det-kan-bli-mer-omfattende</a></li>
    <li><a href="https://www.vg.no/nyheter/innenriks/i/K375oe/nye-tall-totalt-19-corona-smittede-i-norge">nye-tall-totalt-19-corona-smittede-i-norge</a></li>
    </ul>
    <h4>&nbsp;&nbsp;History data archives:</h4>
    <ul>
    <!-- <li><a href="/history?dt=">history-data-</a></li> -->
    <li><a href="/history?dt=202003042300">history-data-2020-0304-2300</a></li>
    <li><a href="/history?dt=202003032330">history-data-2020-0303-2330</a></li>
    <li><a href="/history?dt=202003022230">history-data-2020-0302-2230</a></li>
    <li><a href="/history?dt=202003021630">history-data-2020-0302-1630</a></li>
    </ul>
    <h4>&nbsp;&nbsp;Developer and contact: luyuqing0708@gmail.com</h4>
    </div>
    <p id="labels" style="display: none;">{{ labels }}</p>
    <br></br>
    <script>

      const latlng_ref = {
        'Tromsø(Troms og Finnmark)': {lat: 69.6511986, lng: 18.9469733, cnt: 0},
        'Oslo': {lat: 59.9137808, lng: 10.6450355, cnt: 0},
        'Bærum(Viken)': {lat: 59.9289092, lng: 10.362972, cnt: 0},
        'Nes(Viken)': {lat:59.9405272, lng: 10.7061135, cnt: 0},
        'Enebakk(Viken)': {lat: 59.7691533, lng: 10.9477309, cnt: 0},
        'Drammen(Viken)': {lat: 59.7297215, lng: 10.1992825, cnt: 0},
        'Ås(Viken)': {lat: 59.6616895, lng: 10.7556133, cnt: 0},
        'Asker(Viken)': {lat: 59.9290092, lng: 10.363972, cnt: 0},
        'Lier(Viken)': {lat: 59.9290292, lng: 10.364172, cnt: 0},
        'Fredrikstad(Viken)': {lat: 59.2315278, lng: 10.9179351},
        'Bergen(Vestland)': {lat: 60.3911568, lng: 5.321325, cnt: 0},
        'Øygarden(Vestland)': {lat: 60.329089, lng: 5.0528155, cnt: 0},
        'Stavanger(Rogaland)': {lat: 58.9498173, lng: 5.658187, cnt: 0},
        'Haugesund(Rogaland)': {lat: 59.4138946, lng: 5.2676924, cnt: 0},
        'Klepp(Rogaland)': {lat: 58.7629815, lng: 5.6109107, cnt: 0},
        'Kristiansand(Agder)': {lat: 58.1580637, lng: 7.9730598, cnt: 0},
        'Trondheim(Trøndelag)': {lat: 63.4163902, lng: 10.4392766, cnt: 0},
        'Frosta(Trøndelag)': {lat: 63.615650, lng: 10.826420, cnt: 0},
        'Nord_Fron(Innlandet)': {lat: 61.5598331, lng: 9.5975987, cnt: 0},
        'Sel(Innlandet)': {lat: 61.840969, lng: 9.4252837, cnt: 0},
        'Ålesund(Møre og Romsdal)': {lat: 62.471420, lng: 6.148600, cnt: 0},
        'Molde(Møre og Romsdal)': {lat: 62.7429118, lng: 7.162816, cnt: 0},
        'Skien(Vestfold og Telemark)': {lat: 59.1995043, lng: 9.5750582, cnt: 0},
        'Ukjent_Kommune(Vestfold og Telemark)': {lat: 59.1717782, lng: 9.428277, cnt: 0},
        'Ukjent_Fylke': {lat: 62.9948397, lng: 7.8752033, cnt: 0},
      };

      var data = [
        {label: 'case-1-Tromsø(Troms og Finnmark)', lat: null, lng: null},
        {label: 'case-2-Oslo', lat: null, lng: null},
        {label: 'case-3-Oslo', lat: null, lng: null},
        {label: 'case-4-Oslo', lat: null, lng: null},
        {label: 'case-5-Bærum(Viken)', lat: null, lng: null},
        {label: 'case-6-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-7-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-8-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-9-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-10-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-11-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-12-Oslo', lat: null, lng: null},
        {label: 'case-13-Oslo', lat: null, lng: null},
        {label: 'case-14-Oslo', lat: null, lng: null},
        {label: 'case-15-Oslo', lat: null, lng: null},
        {label: 'case-16-Nes(Viken)', lat: null, lng: null},
        {label: 'case-17-Enebakk(Viken)', lat: null, lng: null},
        {label: 'case-18-Enebakk(Viken)', lat: null, lng: null},
        {label: 'case-19-Enebakk(Viken)', lat: null, lng: null},
        {label: 'case-20-Stavanger(Rogaland)', lat: null, lng: null},
        {label: 'case-21-Kristiansand(Agder)', lat: null, lng: null},
        {label: 'case-22-Kristiansand(Agder)', lat: null, lng: null},
        {label: 'case-23-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-24-Øygarden(Vestland)', lat: null, lng: null},
        {label: 'case-25-Øygarden(Vestland)', lat: null, lng: null},
        {label: 'case-26-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-27-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-28-Kristiansand(Agder)', lat: null, lng: null},
        {label: 'case-29-Tromsø(Troms og Finnmark)', lat: null, lng: null},
        {label: 'case-30-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-31-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-32-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-33-Ås(Viken)', lat: null, lng: null},
        {label: 'case-34-Trondheim(Trøndelag)', lat: null, lng: null},
        {label: 'case-35-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-36-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-37-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-38-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-39-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-40-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-41-Haugesund(Rogaland)', lat: null, lng: null},
        {label: 'case-42-Oslo', lat: null, lng: null},
        {label: 'case-43-Oslo', lat: null, lng: null},
        {label: 'case-44-Oslo', lat: null, lng: null},
        {label: 'case-45-Oslo', lat: null, lng: null},
        {label: 'case-46-Oslo', lat: null, lng: null},
        {label: 'case-47-Oslo', lat: null, lng: null},
        {label: 'case-48-Oslo', lat: null, lng: null},
        {label: 'case-49-Klepp(Rogaland)', lat: null, lng: null},
        {label: 'case-50-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-51-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-52-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-53-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-54-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-55-Nord_Fron(Innlandet)', lat: null, lng: null},
        {label: 'case-56-Nord_Fron(Innlandet)', lat: null, lng: null},
        {label: 'case-57-Nord_Fron(Innlandet)', lat: null, lng: null},
        {label: 'case-58-Bærum(Viken)', lat: null, lng: null},
        {label: 'case-59-Bærum(Viken)', lat: null, lng: null},
        {label: 'case-60-Bærum(Viken)', lat: null, lng: null},
        {label: 'case-61-Asker(Viken)', lat: null, lng: null},
        {label: 'case-62-Lier(Viken)', lat: null, lng: null},
        {label: 'case-63-Stavanger(Rogaland)', lat: null, lng: null},
        {label: 'case-64-Sel(Innlandet)', lat: null, lng: null},
        {label: 'case-65-Frosta(Trøndelag)', lat: null, lng: null},
        {label: 'case-66-Ålesund(Møre og Romsdal)', lat: null, lng: null},
        {label: 'case-67-Molde(Møre og Romsdal)', lat: null, lng: null},
        {label: 'case-68-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-69-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-70-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-71-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-72-Bergen(Vestland)', lat: null, lng: null},
        {label: 'case-73-Skien(Vestfold og Telemark)', lat: null, lng: null},
        {label: 'case-74-Ukjent_Kommune(Vestfold og Telemark)', lat: null, lng: null},
        {label: 'case-75-Ukjent_Kommune(Vestfold og Telemark)', lat: null, lng: null},
        {label: 'case-76-Ukjent_Kommune(Vestfold og Telemark)', lat: null, lng: null},
        {label: 'case-77-Oslo', lat: null, lng: null},
        {label: 'case-78-Oslo', lat: null, lng: null},
        {label: 'case-79-Oslo', lat: null, lng: null},
        {label: 'case-80-Oslo', lat: null, lng: null},
        {label: 'case-81-Trondheim(Trøndelag)', lat: null, lng: null},
        {label: 'case-82-Trondheim(Trøndelag)', lat: null, lng: null},
        {label: 'case-83-Trondheim(Trøndelag)', lat: null, lng: null},
        {label: 'case-84-Trondheim(Trøndelag)', lat: null, lng: null},
        {label: 'case-85-Trondheim(Trøndelag)', lat: null, lng: null},
        {label: 'case-86-Drammen(Viken)', lat: null, lng: null},
        {label: 'case-87-Fredrikstad(Viken)', lat: null, lng: null},
        {label: 'case-88-Stavanger(Rogaland)', lat: null, lng: null},
      ];

      function update_latlng(data) {
        for (var i=0; i<data.length; i++) {
          let area = data[i].label.split('-').pop();
          console.log(area);
          data[i].lat = latlng_ref[area].lat + 0.0002 * (latlng_ref[area].cnt % 5);
          data[i].lng = latlng_ref[area].lng + 0.0002 * (Math.floor(latlng_ref[area].cnt/5));
          latlng_ref[area].cnt += 1;
        }
      }

      update_latlng(data);
      console.log(data);

      document.getElementById('total_number').textContent = data.length;
      const yesterday_number = parseInt(document.getElementById("yesterday_number").textContent);
      const new_cases_number = data.length - yesterday_number;
      document.getElementById('new_cases_number').textContent = new_cases_number;

      const labels = data.map(x => x.label);
      const locations = data.map(function(x){return {lat: x.lat, lng: x.lng}});

      var area_dict = {
        'Vestland': {'Total': 0},
        'Rogaland': {'Total': 0},
        'Oslo': {'Total': 0},
        'Viken': {'Total': 0},
        'Troms og Finnmark': {'Total': 0},
        'Agder': {'Total': 0},
        'Innlandet': {'Total': 0},
        'Møre og Romsdal': {'Total': 0},
        'Nordland': {'Total': 0},
        'Vestfold og Telemark': {'Total': 0},
        'Trøndelag': {'Total': 0},
        'Ukjent_Fylke': {'Total': 0}
      };

      for (i=0; i<data.length; i++) {
        let area = data[i].label.split('-').pop();
        if (area == 'Oslo' || area == 'Ukjent_Fylke') {
          area_dict[area]['Total'] += 1;
        } else {
          var kommune = area.split('(')[0]
          var fylke = area.split('(')[1].split(')')[0];
          area_dict[fylke]['Total'] += 1;
          if (area_dict[fylke][kommune] === undefined) {
            area_dict[fylke][kommune] = 1;
          } else {
            area_dict[fylke][kommune] += 1;
          }
        }
      }

      for (var prop in area_dict) {
        if (area_dict[prop]['Total'] > 0) {
          var line = prop + ': ' + area_dict[prop]['Total'];
          var li = document.createElement("li");
          li.appendChild(document.createTextNode(line));
          document.getElementById("area_number").appendChild(li);
          if (Object.keys(prop).length > 1) {
            for (var sub_prop in area_dict[prop]) {
              if (sub_prop != 'Total') {
                var sub_line = sub_prop + ': ' + area_dict[prop][sub_prop];
                var sub_ul = document.createElement("ul");
                var sub_li = document.createElement("li");
                sub_li.appendChild(document.createTextNode(sub_line));
                sub_ul.appendChild(sub_li);
                li.appendChild(sub_ul);
              }
            }
          }
          }
      }

      function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: {lat: 62.3507604, lng: 6.7845958}
        });

        // Add some markers to the map.
        // Note: The code uses the JavaScript Array.prototype.map() method to
        // create an array of markers based on a given "locations" array.
        // The map() method here has nothing to do with the Google Maps API.
        var markers = locations.map(function(location, i) {
          return new google.maps.Marker({
            position: location,
            label: labels[i % labels.length]
          });
        });

        // Add a marker clusterer to manage the markers.
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
      }

    </script>
    <!-- Replace following script src -->
    <script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCU8AOyOFfPBH5aZnphqXhg6aeD6dix0nk&callback=initMap">
    </script>
  </body>
</html>